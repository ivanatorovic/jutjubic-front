<div class="page">
  <!-- Top bar -->
  <header class="topbar">
  <a class="brand" routerLink="/videos" aria-label="jutjubic home">
    <span class="logo">â–¶</span>
    <span class="name">jutjubic</span>
  </a>
  <!-- âœ… UPLOAD PROGRESS BANNER -->
<!-- UPLOAD PROGRESS BANNER -->
<div class="upload-banner" *ngIf="uploadState.status !== 'idle'">

  <!-- UPLOADING -->
  <div *ngIf="uploadState.status === 'uploading'" class="ub-row">
    <span class="ub-text">
      Upload u tokuâ€¦ {{ uploadState.progress }}%
    </span>
    <div class="ub-progress">
      <div
        class="ub-bar"
        [style.width.%]="uploadState.progress">
      </div>
    </div>
  </div>

  <!-- DONE -->
  <div *ngIf="uploadState.status === 'done'" class="ub-row ok">
    <span class="ub-text">Upload zavrÅ¡en âœ…</span>
    <div class="ub-progress">
      <div class="ub-bar" style="width: 100%"></div>
    </div>
  </div>

  <!-- ERROR -->
  <div *ngIf="uploadState.status === 'error'" class="ub-row bad">
    <span class="ub-text">
      Upload neuspeÅ¡an âŒ {{ uploadState.message }}
    </span>
  </div>

</div>

    <!-- DESNO -->
    <div class="top-actions">
      <!-- ako nije ulogovan -->
      <ng-container *ngIf="!isLoggedIn(); else logged">
      <button type="button" class="btn ghost" routerLink="/login">Prijava</button>
      <button type="button" class="btn primary" routerLink="/register">Registracija</button>

      </ng-container>

      <!-- ako jeste ulogovan -->
      <ng-template #logged>
        <button class="btn ghost" routerLink="/upload">Upload</button>

        <!-- Profil se prikazuje samo ako imamo userId iz tokena -->
        <button
          class="btn ghost"
          *ngIf="currentUserId !== null"
          [routerLink]="['/user-profile', currentUserId]"
        >
          Profil
        </button>

        <button class="btn primary" (click)="logout()">Logout</button>
      </ng-template>
    </div>
  </header>

  <div *ngIf="loading" class="state">UÄitavam videe...</div>
  <div *ngIf="!loading && error" class="state error">{{ error }}</div>

  <div class="grid" *ngIf="!loading && !error">
    <article
      class="card"
      *ngFor="let v of videos"
      (click)="openWatch(v.id)"
      role="button"
      tabindex="0"
      (keydown.enter)="openWatch(v.id)"
      (keydown.space)="openWatch(v.id)"
    >
   <div
  class="thumb-wrap"
  
>
  <img
    class="thumb"
    [src]="videoService.thumbnailUrl(v.id)"
    alt="thumbnail"
  />

  

  <div class="play-overlay">â–¶</div>

  <div class="badge" *ngIf="v.location">ğŸ“ {{ v.location }}</div>
</div>



      <div class="info">
        <div class="title" [title]="v.title">{{ v.title }}</div>

        <div class="sub">
          <span
            class="user"
            (click)="openUser(v.userId, $event)"
            role="link"
            tabindex="0"
            (keydown.enter)="openUser(v.userId, $event)"
          >
            <span class="avatar">
              {{ (v.username ?? '?').slice(0, 1).toUpperCase() }}
            </span>
            <span class="uname">{{ v.username ?? 'Nepoznat autor' }}</span>
          </span>

          <span class="dot">â€¢</span>
          <span class="time">{{ formatTime(v.createdAt) }}</span>
        </div>

        <div class="stats">
           <span class="chip">ğŸ‘ï¸ {{ v.viewCount ?? 0 }}</span>
          <span class="chip">ğŸ‘ {{ v.likeCount ?? 0 }}</span>
          <span class="chip">ğŸ’¬ {{ v.commentCount ?? 0 }}</span>
        </div>
      </div>
    </article>

    <div *ngIf="videos.length === 0" class="state">
      Nema videa joÅ¡.
    </div>
  </div>
</div>
